{% load static %}

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>STEP 3</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="{% static 'img/favicon.ico' %}"/>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'css/all.min.css' %}">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- icheck bootstrap -->
  <link rel="stylesheet" href="{% static 'css/icheck-bootstrap.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'css/adminlte.min.css' %}">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <!-- jQuery -->
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <!-- Bootstrap 4 -->
  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
  <!-- AdminLTE App -->
  <script src="{% static 'js/adminlte.min.js' %}"></script>
  <!-- DEMO -->
  <script src="{% static 'js/demo.js' %}"></script>

  <link href="https://fonts.googleapis.com/css?family=Inconsolata&display=swap" rel="stylesheet">
</head>

<body class="hold-transition sidebar-mini">

  <div class="wrapper ">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link sidebar-mini sidebar-collapse" data-toggle="collapse" data-widget="pushmenu" href="#"><i class="fa fa-bars"></i></a>
        </li>
        {% comment %} <li class="nav-item d-none d-sm-inline-block">
          <a href="step1" class="nav-link">Home</a>
        </li> {% endcomment %}
        <li class="nav-item d-none d-sm-inline-block">
          <a href="support" class="nav-link">Contact</a>
        </li>
      </ul>


      <!-- SEARCH FORM -->
      <form class="form-inline ml-3">
        <div class="input-group input-group-sm">
          <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-navbar" type="submit">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
      </form>
      <ul class="navbar-nav ml-auto">
            <!-- Messages Dropdown Menu -->
            <li class="nav-item dropdown">
                {% for i in obj %}
                    <a href="profile" class="nav-link"><i class="fa fa-user-o" aria-hidden="true" style="color:black"></i> {{ i.first_name }} {{ i.last_name }}</a>
                {% endfor %}
            </li>
          </ul>
    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->

      <a href="step1" class="brand-link" style="text-align: center;">
        <span class="brand-text">
        <img src="{% static 'img/icon/ktpllogo.png' %}" class="brand-image center" style=" width:70%; height:70%;"><br>
        </span>
      </a>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar user (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
          <div class="image">
            <img src="{% static 'img/icon/whatsapp .png' %}" alt="User Image" >
          </div>
          <div class="info">
            <h5 class="d-block" style="color:white">WhatsApp Beta</h5>
          </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">

<!--        <li class="nav-item has-treeview" >-->
<!--        <a href="dashboard" class="nav-link " >-->
<!--            <i class="nav-icon fa fa-dashcube" ></i>-->
<!--              <b><p>Dashboard</p></b>-->
<!--          </a>-->
<!--        </li>-->

            <li class="nav-item has-treeview" >
              <a href="step1" class="nav-link active active" >
                <i class="nav-icon fa fa-graduation-cap" ></i>
                <p>Learn</p>
              </a>
            </li>

            <li class="nav-item has-treeview">
              <a href="businessprofile" class="nav-link">
                <i class="nav-icon fa fa-try"></i>
                  <p>Apply</p>
              </a>
            </li>

            {% comment %} <li class="nav-item has-treeview" >
              <a href="sandbox" class="nav-link" >
                <i class="nav-icon fa fa-shield" ></i>
                  <p>Sandbox</p>
              </a>
            </li> {% endcomment %}

            <li class="nav-item has-treeview">
              <a href="senders" class="nav-link ">
                <i class="nav-icon fa fa-users"></i>
                  <p>Whatsapp Numbers</p>
              </a>
            </li>

            <li class="nav-item has-treeview">
              <a href="#" class="nav-link">
                <i class="nav-icon fa fa-commenting "></i>
                <p>
                  Chat Window
                  <i class="fa fa-angle-left right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="chat_statistics" class="nav-link">
                    <i class="fa fa-circle nav-icon"></i>
                    <p>Chat Dashboard</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="audience" class="nav-link">
                    <i class="fa fa-circle nav-icon"></i>
                    <p>Audience</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="converse" class="nav-link">
                    <i class="fa fa-circle nav-icon"></i>
                    <p>Converse</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="announce" class="nav-link">
                    <i class="fa fa-circle nav-icon"></i>
                    <p>Announce</p>
                  </a>
                </li>
              </ul>
            </li>

            <li class="nav-item has-treeview">
              <a href="logs" class="nav-link">
                <i class="nav-icon fa fa-history"></i>
                  <p>Logs</p>
              </a>
            </li>

            <li class="nav-item has-treeview">
              <a href="#" class="nav-link">
                <i class="nav-icon fa fa-edit"></i>
                <p>
                  Insights
                  <i class="fa fa-angle-left right"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="insight1" class="nav-link">
                    <i class="fa fa-circle nav-icon"></i>
                    <p>Message Queue</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="insight2" class="nav-link">
                    <i class="fa fa-circle nav-icon"></i>
                    <p>Message Feedback</p>
                  </a>
                </li>
              </ul>
            </li>

            <li class="nav-item has-treeview">
              <a href="usage" class="nav-link">
                <i class="nav-icon fa fa-hourglass-start"></i>
                  <p>Usage</p>
              </a>
            </li>

            <li class="nav-item has-treeview">
              <a href="profile" class="nav-link">
                <i class="nav-icon fa fa-user"></i>
                  <p>Profile</p>
              </a>
            </li>



            {% comment %} <li class="nav-item has-treeview">
              <a href="general_settings" class="nav-link">
                <i class="nav-icon fa fa-cogs"></i>
                <p>
                  Settings
                </p>
              </a>
            </li> {% endcomment %}

            <li class="nav-item has-treeview">
              <a href="logout" class="nav-link">
                <i class="nav-icon fa fa-sign-out"></i>
                  <p>Logout</p>
              </a>
            </li>
          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->

      <!-- Main content -->
      <section class="content ">
        <div class="container" style="padding-top:30px;">

          <div class="card card-primary card-outline" >
            <div class="card-header ">
              <h2>Learn: Khairnar Technologies Sandbox for WhatsApp</h2>
            </div>
            <div class="card-body ">

            <h4 class="mt-4">3. Two-Way Messaging</h4>
              <div class="row ">
                <div class="col-lg-8 col-sm-12" style="text-align:justify">
                  <div class="tab-content" id="vert-tabs-right-tabContent">
                    <div class="tab-pane fade show active" id="vert-tabs-right-home" role="tabpanel" aria-labelledby="vert-tabs-right-home-tab">
                      Now that you've used a template to send a one-way WhatsApp message, let's learn about Two-Way Messaging.<br><br>
                      In real-world scenarios, when a user replies to your outbound WhatsApp message, or sends you a direct message,
                      a 24-hour, two-way conversation window is created. You can freely converse with the customer during
                      that time, without the use of templates.<br><br>
                      To test this, simply reply to the WhatsApp notification you just received on your device to start a 24-hour conversation window.
                    </div>
                  </div>
                </div>
                <div class="col-4 col-sm-3">
                  <img src="{% static 'img/ilstrator/phone.png' %}" class="brand-image center" style="width:60%;">
                </div>
              </div>

              <div class="row" >
                <div class="col-lg-5 col-sm-9 box_recv" >
                  <div class="tab-content" id="vert-tabs-right-tabContent" >
                    <div class="tab-pane fade show active" id="vert-tabs-right-home" role="tabpanel" aria-labelledby="vert-tabs-right-home-tab">
                      <p  style="padding-bottom:20px; line-height:20px;">Message: <br><span id="latest_message"></span></p>
                      {% for i in obj %}
                      <p >From:<b id="phone">91{{i.phone}}</b></p>
                       {% endfor %}
                      <p>To: Khairnar Technologies</p>
                    </div>
                  </div>
                </div>
            </div>

            <div class="row">
              <div class="col-lg-12 col-sm-9">
                <div class="tab-content" id="vert-tabs-right-tabContent">
                  <div class="tab-pane fade show active" id="vert-tabs-right-home1" role="tabpanel" aria-labelledby="vert-tabs-right-home-tab">
                    <p >Waiting for your Message
                    <img src="{% static 'img/icon/loading.gif' %}" style="width:5%"></p>
                  </div>
                  <div class="row" style="padding-top:10px;">
              <div class="col-lg-6 col-sm-9">
                <div class="tab-content" id="vert-tabs-right-tabContent">
                  <div class="tab-pane fade show active"  role="tabpanel" aria-labelledby="vert-tabs-right-home-tab" id="message-try" class="tab-content" style="display: none;">
                    <p><i class="fa fa-check" aria-hidden="true" style="color:green"></i> Message Received! You now have 24-hours between your Sandbox and your WhatsApp account, without the use of templates:</p>
                  </div>
                </div>
              </div>
          </div>
                </div>
              </div>
            </div>

            <div class="row" >
              <div class="col-lg-3 col-md-6 col-sm-4">
                <div class="tab-content" id="vert-tabs-right-tabContent">
                  <div class="tab-pane fade show active" id="vert-tabs-right-home" role="tabpanel" aria-labelledby="vert-tabs-right-home-tab">
                  <button type="button" class="btn btn-block bg-gradient-danger" onclick="location.href='step4'">Send a Reply</button>

                  </div>
                </div>
              </div>
            </div>

          <!-- /.card -->

          <!-- /.card -->
          <div class="row"  style="padding-top:15px">
            <div class=" col-lg-12">
              <div class="row">
                <div class="col-lg-6 col-md-9 col-sm-9" style="text-align:justify">
                  <button type="button" class="btn btn-block  btn-default" onclick="location.href = 'step2';"><b>Previous: Send a One-Way Template Message</b></button>
                </div>
              <div class="col-lg-6 col-md-9 col-sm-9" style="text-align:justify">
                <button type="button" class="btn btn-block btn-default" disabled><b>Next: Apply Now</b></button>
              </div>
            </div>

            <div class="card-body">
              <div class="progress">
                <div class="progress-bar bg-primary progress-bar-striped" role="progressbar" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
        <!-- /.container-fluid -->
  </section>
      <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <div class="main-footer">
      <strong>Copyright &copy; 2021 <a href="#">Khairnar Technologies Private Limited</a>.</strong>
      All rights reserved.
    </div>

    <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->

<script>
  $(document).ready(function(){
    var phone1 = $("#phone").text();
    console.log(phone1);
        poll = function() {
                  $.ajax({
                    url: '/ajax/check_timediff/',
                    dataType: 'JSON',
                    data: {
                      'phone': phone1
                    },
                    success: function(data) {
                      console.log(data['diff']);
                      if (data['diff'] == "more"){
                        console.log('wait for a message');
                      }
                      if (data['diff'] == "less") {
                        console.log('less');
                        $("#message-try").css('display','block');
                        $("#vert-tabs-right-home1").css('display','none');
                        $("#latest_message").text(data['message']);
                        clearInterval(pollInterval);
                      }
                    },
                    error: function() {
                      console.log("error");
                    }
                  });
                },

        pollInterval = setInterval(function() {
          poll();
        }, 5000)
        poll();
  })
</script>

</body>
</html>
