{% load static %}

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>STEP 4</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="{% static 'img/favicon.ico' %}"/>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'css/all.min.css' %}">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- icheck bootstrap -->
  <link rel="stylesheet" href="{% static 'css/icheck-bootstrap.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'css/adminlte.min.css' %}">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <!-- jQuery -->
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <!-- Bootstrap 4 -->
  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
  <!-- AdminLTE App -->
  <script src="{% static 'js/adminlte.min.js' %}"></script>
  <!-- DEMO -->
  <script src="{% static 'js/demo.js' %}"></script>

  <link href="https://fonts.googleapis.com/css?family=Inconsolata&display=swap" rel="stylesheet">
</head>

<body class="hold-transition sidebar-mini">

  <div class="wrapper ">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link sidebar-mini sidebar-collapse" data-toggle="collapse" data-widget="pushmenu" href="#"><i class="fa fa-bars"></i></a>
        </li>
        {% comment %} <li class="nav-item d-none d-sm-inline-block">
          <a href="step1" class="nav-link">Home</a>
        </li> {% endcomment %}
        <li class="nav-item d-none d-sm-inline-block">
          <a href="support" class="nav-link">Contact</a>
        </li>
      </ul>


      <!-- SEARCH FORM -->
      <!-- <form class="form-inline ml-3">
        <div class="input-group input-group-sm">
          <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-navbar" type="submit">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
      </form> -->

      <ul class="navbar-nav ml-auto">
        <!-- Messages Dropdown Menu -->
        <li class="nav-item dropdown">
            {% for i in obj %}
                <a href="profile" class="nav-link"><i class="fa fa-user-o" aria-hidden="true" style="color:black"></i> {{ i.first_name }} {{ i.last_name }}</a>
            {% endfor %}
        </li>
      </ul>
</nav>
<!-- /.navbar -->

<!-- Main Sidebar Container -->
<aside class="main-sidebar sidebar-dark-primary elevation-4">
  <!-- Brand Logo -->

  <a href="step1" class="brand-link" style="text-align: center;">
    <span class="brand-text">
          <img src="{% static 'img/icon/ktpllogo.svg' %}" class="brand-image center" style=" width:100%; height:100%;"><br>
    </span>
  </a>

  <!-- Sidebar -->
  <div class="sidebar">
    <!-- Sidebar user (optional) -->
    <div class="user-panel mt-3 pb-3 mb-3 d-flex">
      <div class="image">
        <img src="{% static 'img/icon/whatsapp .png' %}" alt="User Image" >
      </div>
      <div class="info">
        <h5 class="d-block" style="color:white">WhatsApp Beta</h5>
      </div>
    </div>

    <!-- Sidebar Menu -->
    <nav class="mt-2">
      <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">

        {% comment %} <li class="nav-item has-treeview" >
       <a href="dashboard" class="nav-link " >
           <i class="nav-icon fa fa-dashcube" ></i>
              <b><p>Dashboard</p></b>
          </a>
       </li> {% endcomment %}

        <li class="nav-item has-treeview" >
          <a href="step1" class="nav-link active" >
            <i class="nav-icon fa fa-graduation-cap" ></i>
            <p>Learn</p>
          </a>
        </li>
          <li class="nav-item has-treeview">
          <a href="businessprofile" class="nav-link">
            <i class="nav-icon fa fa-try"></i>
              <p>Apply</p>
          </a>
        </li>

{% comment %} 
        <li class="nav-item has-treeview" >
          <a href="sandbox" class="nav-link" >
            <i class="nav-icon fa fa-shield" ></i>
              <p>Sandbox</p>
          </a>
        </li> {% endcomment %}

        <li class="nav-item has-treeview">
          <a href="senders" class="nav-link">
            <i class="nav-icon fa fa-users"></i>
              <p>Whatsapp Numbers</p>
          </a>
        </li>

        <li class="nav-item has-treeview">
          <a href="#" class="nav-link">
            <i class="nav-icon fa fa-commenting "></i>
            <p>
              Chat Window
              <i class="fa fa-angle-left right"></i>
            </p>
          </a>
          <ul class="nav nav-treeview">
            <!-- <li class="nav-item">
              <a href="chat_statistics" class="nav-link">
                <i class="fa fa-circle nav-icon"></i>
                <p>Chat Dashboard</p>
              </a>
            </li>
            <li class="nav-item">
              <a href="audience" class="nav-link">
                <i class="fa fa-circle nav-icon"></i>
                <p>Audience</p>
              </a>
            </li> -->
            <li class="nav-item">
              <a href="converse" class="nav-link">
                <i class="fa fa-circle nav-icon"></i>
                <p>Converse</p>
              </a>
            </li>
            <!-- <li class="nav-item">
              <a href="announce" class="nav-link">
                <i class="fa fa-circle nav-icon"></i>
                <p>Announce</p>
              </a>
            </li> -->
          </ul>
        </li>

        <!-- <li class="nav-item has-treeview">
          <a href="logs" class="nav-link">
            <i class="nav-icon fa fa-history"></i>
              <p>Logs</p>
          </a>
        </li>

        <li class="nav-item has-treeview">
          <a href="#" class="nav-link">
            <i class="nav-icon fa fa-edit"></i>
            <p>
              Insights
              <i class="fa fa-angle-left right"></i>
            </p>
          </a>
          <ul class="nav nav-treeview">
            <li class="nav-item">
              <a href="insight1" class="nav-link">
                <i class="fa fa-circle nav-icon"></i>
                <p>Message Queue</p>
              </a>
            </li>
            <li class="nav-item">
              <a href="insight2" class="nav-link">
                <i class="fa fa-circle nav-icon"></i>
                <p>Message Feedback</p>
              </a>
            </li>
          </ul>
        </li> -->

        <!-- <li class="nav-item has-treeview">
          <a href="usage" class="nav-link">
            <i class="nav-icon fa fa-hourglass-start"></i>
              <p>Usage</p>
          </a>
        </li> -->

        <li class="nav-item has-treeview">
          <a href="profile" class="nav-link">
            <i class="nav-icon fa fa-user"></i>
              <p>Profile</p>
          </a>
        </li>


        {% comment %} <li class="nav-item has-treeview">
          <a href="general_settings" class="nav-link">
            <i class="nav-icon fa fa-cogs"></i>
            <p>
              Settings
            </p>
          </a>
        </li> {% endcomment %}


        <li class="nav-item has-treeview">
          <a href="logout" class="nav-link">
            <i class="nav-icon fa fa-sign-out"></i>
              <p>Logout</p>
          </a>
        </li>
      </ul>
    </nav>
    <!-- /.sidebar-menu -->
  </div>
  <!-- /.sidebar -->
</aside>


    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->


      <!-- Main content -->
      <section class="content ">
        <div class="container" style="padding-top:30px;">

          <div class="card card-primary card-outline" >
            <div class="card-header ">
              <h2>Learn: Khairnar Technologies Sandbox for WhatsApp</h2>
            </div>
            <div class="card-body ">

            <h4 class="mt-4">4. Two-Way Messaging</h4>

            <div class="row" >
                <div class="col-lg-5 col-sm-9 box_recv" >
                  <div class="tab-content" id="vert-tabs-right-tabContent" >
                    <div class="tab-pane fade show active" id="vert-tabs-right-home" role="tabpanel" aria-labelledby="vert-tabs-right-home-tab">
                      <p  style="padding-bottom:20px; line-height:20px;">Message: <br><span id="latest_message"></span></p>
                      {% for i in obj %}
                      <p >From:<b id="phone">91{{i.phone}}</b></p>
                       {% endfor %}
                      <p>To: Khairnar Technologies</p>
                    </div>
                  </div>
                </div>
            </div>

              {% comment %} <div class="row" >
                <div class="col-lg-6   col-sm-9 box_recv">
                  <div class="tab-content" id="vert-tabs-right-tabContent">
                    <div class="tab-pane fade show active" id="vert-tabs-right-home" role="tabpanel" aria-labelledby="vert-tabs-right-home-tab">
                      <p>Message:</p>
                      <p>To:</p>
                      <p>From:</p>
                    </div>
                  </div>
                </div>
            </div> {% endcomment %}

            <div class="row">
              <div class="col-lg-12 col-sm-9">
                <div class="tab-content" id="vert-tabs-right-tabContent">
                  <div class="tab-pane fade show active" id="vert-tabs-right-home1" role="tabpanel" aria-labelledby="vert-tabs-right-home-tab">
                    <p >Waiting for your Message
                    <img src="{% static 'img/icon/loading.gif' %}" style="width:5%"></p>
                  </div>
                  {% comment %} <div id="message-try" class="tab-content" style="display: none;">
                    <p>Your session is Active due the above message (sent wthin the last 24 hours). Please continue</p>
                  </div> {% endcomment %}
                  <div class="row" style="padding-top:10px;">
              <div class="col-lg-6 col-sm-9">
                <div class="tab-content" id="vert-tabs-right-tabContent">
                  <div class="tab-pane fade show active" role="tabpanel" aria-labelledby="vert-tabs-right-home-tab" id="message-try" class="tab-content" style="display: none;">
                    <p><i class="fa fa-check" aria-hidden="true" style="color:green"></i> Message Received! You now have 24-hours between your Sandbox and your WhatsApp account, without the use of templates:</p>
                  </div>
                </div>
              </div>
          </div>
                </div>
              </div>
            </div>

            

          <div class="row" id="verification_code" >
            <h4>Send a reply to the above message from the sandbox</h4>

            <div class="row" style=" padding-top:30px; width:100%;">

              <div class="col-lg-6">

                <div class="row">
                  <div class="col-lg-8" >
                    <p><b>Parameters</b></p>
                  </div>

                  {% comment %} <div class="col-lg-4">
                    <p><a href="#">View Docs</a></p>
                  </div> {% endcomment %}
                </div> <!-- second row closed -->

                <p>TO<p>
                  <div class="input-group mb-3">
                  {% for i in obj %}
                    <input id="to" name="to" type="text" class="form-control filter" placeholder="{{i.phone}}" value="{{i.phone}}" disabled>
                    {% endfor %}
                  </div>

                  {% comment %} <p>FROM<p>
                    <div class="input-group mb-3">
                      <select id="from" name="from" class="custom-select" required="">
                        <option disabled="" selected="" hidden="">Select</option>
                        <option value="">Number</option>
                      </select>
                    </div> {% endcomment %}

                  <p>BODY<p>
                    <div class="input-group mb-3">
                      <input id="body" name="body" type="text" class="form-control filter">
                    </div>

                    <div style="padding-bottom:15px; ">
                    <button id="refresh" type="submit" class="btn btn-block bg-gradient-danger hide_btn" style=" float:left; width:150px;" >
                      Click to Preview
                    </button>

                      <button id="submit_hide" type="submit" class="btn btn-block bg-gradient-danger hide_btn" style=" float:left; width:150px; margin-left:15px;">Make Request</button>
                      
                    </div>     
                    
                           



                    {% comment %} <div  class="alert alert-success alert-dismissible" id="alert-message" style="display:none">
                    <h5 id="Error-or-success"><i class="icon fa fa-check"></i></h5>
                  <!-- <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button> -->
                  <h5><i class="icon fa fa-check"></i> Success!</h5>
                </div> {% endcomment %}
                <div  class="alert alert-success alert-dismissible" id="alert-message" style="display: none; margin-top:40px">
                   <!-- <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button> -->
                  <h5 id="Error-or-success"><i class="icon fa fa-check"></i></h5>
                </div>


                </div> <!-- col-6 closed -->

              <div class="col-lg-6" style="display:block;" id="preview_tab">

                      <div class="row bg-gray color-palette" style="padding-top:7px; padding-left:20px; border-radius: 25px; margin-bottom:10px;">
        
                          <p ><b>Preview Template</b></p>
                     
                     </div> <!-- second row closed -->

                    <div class="row " style="height:250px; padding-top:20px; border-radius: 25px; background-color: 	#C0C0C0; margin-bottom:10px; overflow:scroll; overflow:auto; "  >

                    <p style="padding-left:20px; padding-right:20px; display:block;" id="preview_message_body">
                      </p>

                    

                </div>

                
              

                  


<!--              <div class="row">-->
<!--                <div class="col-lg-11" >-->
<!--                  <p>Response will appear here after you make request</p>-->
<!--                </div>-->
<!--                <div class="col-lg-1">-->
<!--                  <i class="fa fa-clone" aria-hidden="true"></i>-->
<!--                </div>-->
<!--                <hr>-->
<!--            </div> &lt;!&ndash; second row closed &ndash;&gt;-->

         </div> <!-- col-6 closed -->

           

<!--              <div class="row">-->
<!--                <div class="col-lg-6" >-->
<!--                  <p> <input id="check" type="checkbox" required="">-->
<!--                  <label for="checkboxPrimary2"></label> Show your Auth Token</p>-->
<!--                </div>-->
<!--                <div class="col-lg-6">-->
<!--                  <p style="padding-left:20px;"><a href="#">Check out the curl manpage </a><i class="fa fa-clone" aria-hidden="true"></i></p>-->
<!--                </div>-->
<!--                <hr>-->
<!--             </div> &lt;!&ndash; second row closed &ndash;&gt;-->

            {% comment %} <div class="col-lg-12">
              <p>curl 'https://abc/2010-04-01/Accounts/AC3ffa56a63d016879ab96df518a094e4e/Messages.json' -X POST \
                  --data-urlencode 'To=whatsapp:+919158754769' \
                  --data-urlencode 'From=whatsapp:+14155238886' \
                  --data-urlencode 'Body=Your appointment is coming up on July 21 at 3PM' \
                  -u AC3ffa56a63d016879ab96df518a094e4e:[AuthToken]
              </p>
            </div> <!-- col-lg-12 closed --> {% endcomment %}

<!--            <div class="row" style="background-color:#696969">-->
<!--              <div class="col-lg-8" >-->
<!--                <p><b>Response</b></p>-->
<!--              </div>-->
<!--              <hr>-->
<!--           </div> &lt;!&ndash; second row closed &ndash;&gt;-->


<!--          <div class="row">-->
<!--            <div class="col-lg-11" >-->
<!--              <p>Response will appear here after you make request</p>-->
<!--            </div>-->
<!--            <div class="col-lg-1">-->
<!--              <i class="fa fa-clone" aria-hidden="true"></i>-->
<!--            </div>-->
<!--          <hr>-->
        </div> <!-- second row closed -->

      </div> <!-- col-6 row closed -->

  </div> <!-- first row closed -->

</div> <!-- main row closed -->

<div class="row"  style="padding-top:15px">
            <div class=" col-lg-12">
              <div class="row">
                <div class="col-lg-6 col-md-9 col-sm-9" style="text-align:justify">
                  <button type="button" class="btn btn-block  btn-default" onclick="location.href = 'step2';" ><b>Previous: Send a One-Way Template Message</b></button>
                </div>
              <div class="col-lg-6 col-md-9 col-sm-9" style="text-align:justify; padding-left:200px;">
                <button type="button" class="btn btn-block btn-default" onclick="location.href = 'businessprofile';" ><b>Next: Apply Now</b></button>
              </div>
            </div>

      <div class="card-body">
        <div class="progress">
          <div class="progress-bar bg-primary progress-bar-striped" role="progressbar" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
          </div>
        </div>
      </div>
          <!-- /.card -->

          <!-- /.card -->

        </div>
      </div>
    </div>
<!-- /.container-fluid -->
  </section>
<!-- /.content -->
  </div>
<!-- /.content-wrapper -->
<div class="main-footer">
<strong>Copyright &copy; 2021 <a href="#">Khairnar Technologies Private Limited</a>.</strong>
All rights reserved.
</div>

<!-- /.control-sidebar -->
</div>




<script>
$(document).ready(function(){
    var phone1 = $("#phone").text();
    console.log(phone1);
        poll = function() {
                  $.ajax({
                    url: '/ajax/check_timediff/',
                    dataType: 'JSON',
                    data: {
                      'phone': phone1
                    },
                    success: function(data) {
                      console.log(data['diff']);
                      if (data['diff'] == "more"){
                        console.log('wait for a message');
                      }
                      if (data['diff'] == "less") {
                        console.log('less');
                        $("#message-try").css('display','block');
                        $("#vert-tabs-right-home1").css('display','none');
                        $("#latest_message").text(data['message']);
                        clearInterval(pollInterval);
                      }
                    },
                    error: function() {
                      console.log("error");
                    }
                  });
                },

        pollInterval = setInterval(function() {
          poll();
        }, 5000)
        poll();
  })

$("#refresh").click(function(){
    var preview_msg_body = $("#body").val();
    document.getElementById("preview_message_body").innerHTML = preview_msg_body;
    // $("#preview_message_body").text(preview_msg_body);

  })




$("#submit_hide").click(function(){
  $("#alert-message").css('display','none');
  var to = "91" + $("#to").val();
      body = $("#body").val();
      console.log(to, body);
      
      $.ajax({
      url: '/ajax/send_message_khairnar/',
      dataType: 'JSON',
      data: {
      'to': to.trim(),
      'message': body,
      'name' : 'Khairnar',

      },
      success: function (data) {
        console.log("Success");
        var status = data['status'];
        if (data['status']=='success'){
          $("#alert-message").css('display','block');
          $("#alert-message").css('background','green');
          $("#Error-or-success").text(status);
        } 

        else {
          console.log(data['status'])
          $("#alert-message").css('display','block');
          $("#alert-message").css('background','#ce3434');
          $("#Error-or-success").text(status);
        }

      },
       error: function(data) {
       console.log("Error");
       }
     });


})




</script>

  </body>
</html>
